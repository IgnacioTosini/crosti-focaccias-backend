name: Keep Render Service Alive

# ‚ö†Ô∏è WORKFLOW DESACTIVADO - Usa sistema de cach√© en frontend
# El keep-alive consume recursos innecesariamente
# Con el cach√© implementado, la app funciona perfectamente aunque el servidor hiberne
# Solo activar si realmente necesitas el servidor 24/7 activo

on:
  # schedule:
  #   - cron: '*/30 * * * *'  # Cada 30 minutos (DESACTIVADO)
  workflow_dispatch:  # Permitir ejecuci√≥n manual solo si es necesario

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Render Service
        run: |
          echo "üîÑ Haciendo ping al servicio de Render..."
          
          # Hacer request al endpoint con timeout extendido y reintentos
          # Render puede tardar hasta 60s en despertar desde hibernaci√≥n
          response=$(curl -s -w "%{http_code}" \
            -H "User-Agent: GitHub-Actions-KeepAlive/1.0" \
            -H "Accept: application/json" \
            --retry 3 \
            --retry-delay 5 \
            --max-time 90 \
            --connect-timeout 30 \
            https://crosti-focaccias-backend.onrender.com/api/focaccias/featured)
          
          http_code="${response: -3}"
          
          if [ "$http_code" = "200" ]; then
            echo "‚úÖ Ping exitoso (HTTP $http_code)"
            echo "üçï Servicio de focaccias mantenido activo"
          elif [ "$http_code" = "000" ]; then
            echo "‚ö†Ô∏è Timeout o conexi√≥n fallida (puede estar despertando)"
            echo "üîÑ Esto es normal en la primera ejecuci√≥n"
            # No fallar - el siguiente ping funcionar√°
            exit 0
          else
            echo "‚ö†Ô∏è Respuesta HTTP: $http_code"
            echo "üîç El servicio respondi√≥ pero con c√≥digo inesperado"
            # No fallar el job por errores ocasionales
            exit 0
          fi
          
      - name: Log Status
        run: |
          echo "üìä Keep-alive ejecutado: $(date)"
          echo "üïê Pr√≥ximo ping en 30 minutos"
          echo "‚ö° Optimizado: reducci√≥n del 83% en consumo vs 5 min"
          echo "üéØ Servicio: crosti-focaccias-backend.onrender.com"